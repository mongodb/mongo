# This file contains resmoke tasks that are owned by Durable Transactions & Availability Core Server Team division

################################################
#                   Variable                   #
################################################
variables:
  # Used when the tests it runs depend only on mongod, mongos, the jstestshell and the tools.
  # THIS HAS COPIES IN
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/clusters_and_integrations/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/durable_transactions_and_availability/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/query/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/non_server_teams/tasks.yml
  # ANY MODIFICATIONS HERE SHOULD ALSO BE MADE IN THOSE FILES
  - &task_template
    name: template
    depends_on:
      - name: archive_dist_test_debug
    commands:
      - func: "do setup"
      - func: "run tests"
        vars:
          resmoke_args: --help
          resmoke_jobs_max: 0 # No cap on number of jobs.

  # THIS HAS COPIES IN
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/clusters_and_integrations/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/durable_transactions_and_availability/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/query/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/non_server_teams/tasks.yml
  # ANY MODIFICATIONS HERE SHOULD ALSO BE MADE IN THOSE FILES
  - &gen_task_template
    name: gen_task_template
    depends_on:
      - name: version_gen
        variant: generate-tasks-for-version
        # This is added because of EVG-18211.
        # Without this we are adding extra dependencies on evergreen and it is causing strain
        omit_generated_tasks: true
      - name: archive_dist_test_debug
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_args: --help

  # THIS HAS COPIES IN
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/clusters_and_integrations/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/durable_transactions_and_availability/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/query/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/non_server_teams/tasks.yml
  # ANY MODIFICATIONS HERE SHOULD ALSO BE MADE IN THOSE FILES
  - &benchmark_template
    name: benchmark_template
    depends_on:
      - name: compile_upload_benchmarks
    commands:
      - func: "do benchmark setup"
      - func: "run benchmark tests"
        vars:
          resmoke_args: --help
          resmoke_jobs_max: 1
          suite: benchmark_suite

  # THIS HAS COPIES IN
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/clusters_and_integrations/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/durable_transactions_and_availability/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/query/tasks.yml
  # ANY MODIFICATIONS HERE SHOULD ALSO BE MADE IN THOSE FILES
  - &jstestfuzz_config_vars
    is_jstestfuzz: true
    num_files: 15
    num_tasks: 5 # Upperbound by `max_sub_suites` specified through the variant with each task still running `num_files` files.
    # It is error prone to require each fuzzer-related Evergreen task to need to override the
    # resmoke_args variable. However, the resmoke_args variable must be defined as a string in the
    # task generation configuration to satisfy mongodb/mongo-task-generator. We therefore specify an
    # empty string for the variable to reflect there are no additional arguments provided to resmoke
    # by default for the fuzzer-related tasks.
    resmoke_args: ""
    resmoke_jobs_max: 1
    should_shuffle: false
    continue_on_failure: false
    # Terminate the function when there has been no output to stdout for 30 minutes. E.g. when something is stuck in an infinite loop.
    # resmoke.py writes the test output to logkeeper and only writes to stdout when starting the next test.
    # resmoke.py not producing output on stdout means that the test is still running and presumably not going to finish.
    # Note that timeout_secs is different from exec_timeout_secs, which applies to a task and times out regardless of whether output has been written to stdout.
    timeout_secs: 1800

  # Used for tests that invoke 'resmoke.py --suites=jstestfuzz*'.
  # THIS HAS COPIES IN
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/clusters_and_integrations/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/durable_transactions_and_availability/tasks.yml
  # - etc/evergreen_yml_components/tasks/resmoke/server_divisions/query/tasks.yml
  # ANY MODIFICATIONS HERE SHOULD ALSO BE MADE IN THOSE FILES
  - &jstestfuzz_template
    name: jstestfuzz_template
    exec_timeout_secs: 14400 # Time out the task if it runs for more than 4 hours.
    depends_on:
      - name: version_gen
        variant: generate-tasks-for-version
        # This is added because of EVG-18211.
        # Without this we are adding extra dependencies on evergreen and it is causing strain
        omit_generated_tasks: true
      - archive_dist_test_debug
    commands:
      - func: "generate resmoke tasks"

################################################
#                    Tasks                     #
################################################
tasks:
  ################################################
  #              Replication tasks               #
  ################################################

  - <<: *benchmark_template
    name: benchmarks_replication
    tags: ["assigned_to_jira_team_server_repl", "experimental", "benchmarks"]
    commands:
      - func: "do benchmark setup"
      - func: "run benchmark tests"
        vars:
          suite: benchmarks_replication
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: bulk_write_causally_consistent_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_multi_op_causally_consistent_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_multi_op_sharded_collections_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_replica_sets_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_replica_sets_kill_stepdown_terminate_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_replica_sets_multi_stmt_txn_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_replica_sets_multi_stmt_txn_kill_stepdown_terminate_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_sharded_collections_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_sharded_multi_stmt_txn_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: bulk_write_targeted_override_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: concurrency_replication_bulk_write_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "bulk_write"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: concurrency_replication_bulk_write_with_replica_set_endpoint_gen
    tags:
      [
        "assigned_to_jira_team_server_cluster_scalability",
        "experimental",
        "replica_set_endpoint",
        "requires_all_feature_flags",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: magic_restore_replica_sets_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "large"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: magic_restore_sharding_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "large"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: magic_restore_sharded_collections_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default", "large"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *task_template
    name: causally_consistent_jscore_txns_passthrough
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "causally_consistent",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"

  - <<: *gen_task_template
    name: causally_consistent_read_concern_snapshot_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "causally_consistent",
        "read_write_concern",
        "durable_history",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: concurrency_replication_causal_consistency_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "concurrency",
        "repl",
        "large",
        "non_live_record",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1
          use_large_distro: "true"

  - <<: *gen_task_template
    name: concurrency_replication_causal_consistency_with_replica_set_endpoint_gen
    tags:
      [
        "assigned_to_jira_team_server_cluster_scalability",
        "experimental",
        "replica_set_endpoint",
        "requires_all_feature_flags",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "concurrency",
        "common",
        "repl",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_replication_with_replica_set_endpoint_gen
    tags:
      [
        "assigned_to_jira_team_server_cluster_scalability",
        "default",
        "replica_set_endpoint",
        "requires_all_feature_flags",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_replication_multi_stmt_txn_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_debug_mode",
        "concurrency",
        "common",
        "repl",
        "txn",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_replication_multi_stmt_txn_with_replica_set_endpoint_gen
    tags:
      [
        "assigned_to_jira_team_server_cluster_scalability",
        "default",
        "replica_set_endpoint",
        "requires_all_feature_flags",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_replication_multiversion_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "experimental",
        "multiversion",
        "multiversion_passthrough",
      ]
    commands:
      - func: "initialize multiversion tasks"
        vars:
          concurrency_replication_last_continuous_new_new_old: last_continuous
          concurrency_replication_last_continuous_new_old_new: last_continuous
          concurrency_replication_last_continuous_old_new_new: last_continuous
          concurrency_replication_last_lts_new_new_old: last_lts
          concurrency_replication_last_lts_new_old_new: last_lts
          concurrency_replication_last_lts_old_new_new: last_lts
      - func: "generate resmoke tasks"
        vars:
          run_no_feature_flag_tests: "true"

  - <<: *gen_task_template
    name: concurrency_sharded_initial_sync_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_inmemory",
        "incompatible_debug_mode",
        "incompatible_tsan",
        "concurrency",
        "stepdowns",
        "initsync",
        "large",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_kill_primary_with_balancer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "concurrency",
        "stepdowns",
        "kill_terminate",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_local_read_write_multi_stmt_txn_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "concurrency",
        "large",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_local_read_write_multi_stmt_txn_with_balancer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "concurrency",
        "large",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_multi_stmt_txn_kill_primary_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "concurrency",
        "stepdowns",
        "kill_terminate",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_multi_stmt_txn_terminate_primary_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "concurrency",
        "stepdowns",
        "kill_terminate",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_debug_mode",
        "concurrency",
        "common",
        "read_concern_maj",
        "large",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_replication_multiversion_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "experimental",
        "multiversion_passthrough",
        "sharded",
        "multiversion",
      ]
    commands:
      - func: "initialize multiversion tasks"
        vars:
          concurrency_sharded_replication_last_continuous_new_old_old_new: last_continuous
          concurrency_sharded_replication_last_lts_new_old_old_new: last_lts
      - func: "generate resmoke tasks"
        vars:
          run_no_feature_flag_tests: "true"

  - <<: *gen_task_template
    name: concurrency_sharded_replication_no_txns_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "concurrency",
        "no_txns",
        "large",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: concurrency_sharded_replication
          resmoke_args: "--excludeWithAnyTags=uses_transactions"
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_replication_no_txns_with_balancer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "concurrency",
        "no_txns",
        "large",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: concurrency_sharded_replication_with_balancer
          resmoke_args: "--excludeWithAnyTags=uses_transactions"
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_replication_with_balancer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_debug_mode",
        "concurrency",
        "common",
        "read_concern_maj",
        "large",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_sharded_terminate_primary_with_balancer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "concurrency",
        "stepdowns",
        "kill_terminate",
        "sharded",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_simultaneous_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "concurrency",
        "common",
        "large",
        "repl",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  # Tests the runFeatureFlagMultiversionTest helper.
  # This requires the 'featureFlagToaster' and 'featureFlagSpoon' parameters to be set to true on
  # build variants that enable this task.
  - <<: *gen_task_template
    name: feature_flag_multiversion_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "multiversion",
        "no_multiversion_generate_tasks",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          # This task sometimes has outliers that will hit the default exec timeout set by the
          # historical data. We manually increase the timeout above the historical timeout to avoid this
          exec_timeout_secs: 900 # 15 mins

  ## initial sync generational fuzzer to ensure stability in patch builds ##
  - <<: *jstestfuzz_template
    name: initial_sync_fuzzer_sanity_patch_gen
    patch_only: true
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars: &initial_sync_fuzzer_sanity_patch_config
          <<: *jstestfuzz_config_vars
          num_files: 2
          num_tasks: 1
          jstestfuzz_vars: --useEsModules
          npm_command: initsync-fuzzer
          suite: initial_sync_fuzzer
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"

  ## initial sync generational fuzzer ##
  - <<: *jstestfuzz_template
    name: initial_sync_fuzzer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "non_deterministic",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *initial_sync_fuzzer_sanity_patch_config
          num_files: 10
          num_tasks: 5

  ## initial sync multiversion fuzzer ##
  - <<: *jstestfuzz_template
    name: initial_sync_multiversion_fuzzer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "experimental",
        "multiversion_fuzzer",
        "require_npm",
        "random_name",
        "multiversion",
      ]
    commands:
      - func: "initialize multiversion tasks"
        vars:
          initial_sync_fuzzer_last_lts: last_lts
          initial_sync_fuzzer_last_continuous: last_continuous
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: 10
          num_tasks: 5
          jstestfuzz_vars: --useEsModules
          npm_command: initsync-fuzzer
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"
          run_no_feature_flag_tests: "true"

  - <<: *task_template
    name: jsCore_txns
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "jscore",
        "common",
        "txns",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"
        vars:
          suite: core_txns

  - <<: *task_template
    name: jsCore_txns_large_txns_format
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "jscore",
        "txns",
        "multi_oplog",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"
        vars:
          suite: core_txns_large_txns_format

  ## jstestfuzz concurrent replica set ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_concurrent_replication_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "common",
        "repl",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: ${jstestfuzz_concurrent_num_files|10}
          num_tasks: 5
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication
          resmoke_args: --numClientsPerFixture=10

  ## jstestfuzz concurrent replica set with logical session ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_concurrent_replication_session_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "session",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: ${jstestfuzz_concurrent_num_files|10}
          num_tasks: 5
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication_session
          resmoke_args: --numClientsPerFixture=10

  # jstestfuzz concurrent conflict #
  - <<: *jstestfuzz_template
    name: jstestfuzz_concurrent_replication_write_conflicts_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "write_conflict",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication_write_conflicts
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}' --numClientsPerFixture=10"

  ## jstestfuzz file copy based initial sync replica set ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_replication_fcbis_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "initsync",
        "fcbis",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: 8
          num_tasks: 5
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication_fcbis
          resmoke_args: --storageEngine=wiredTiger
          name: jstestfuzz_replication_fcbis

  ## jstestfuzz replica set ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_replication_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "common",
        "repl",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"

  ## jstestfuzz initial sync replica set ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_replication_initsync_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "initsync",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: 8
          num_tasks: 5
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication_initsync
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"

  ## jstestfuzz replica set multiversion ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_replication_multiversion_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "experimental",
        "multiversion_fuzzer",
        "require_npm",
        "random_name",
        "multiversion",
      ]
    commands:
      - func: "initialize multiversion tasks"
        vars:
          jstestfuzz_replication_last_continuous_new_new_old: last_continuous
          jstestfuzz_replication_last_continuous_new_old_new: last_continuous
          jstestfuzz_replication_last_continuous_old_new_new: last_continuous
          jstestfuzz_replication_last_lts_new_new_old: last_lts
          jstestfuzz_replication_last_lts_new_old_new: last_lts
          jstestfuzz_replication_last_lts_old_new_new: last_lts
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          jstestfuzz_vars: --jsTestsDir ../jstests
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"
          npm_command: jstestfuzz
          run_no_feature_flag_tests: "true"

  ## jstestfuzz replica set with logical session ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_replication_session_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "session",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication_session
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"

  ## jstestfuzz replica set endpoint ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_replication_with_replica_set_endpoint_gen
    tags:
      [
        "assigned_to_jira_team_server_cluster_scalability",
        "experimental",
        "replica_set_endpoint",
        "requires_all_feature_flags",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication_with_replica_set_endpoint
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"

  # jstestfuzz write conflict #
  - <<: *jstestfuzz_template
    name: jstestfuzz_replication_write_conflicts_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "write_conflict",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication_write_conflicts
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"

  - <<: *gen_task_template
    name: multiversion_future_git_tag_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "experimental",
        "multiversion",
        "no_multiversion_generate_tasks",
        "multiversion_future_git_tag",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: multiversion_future_git_tag

  - <<: *gen_task_template
    name: multiversion_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "multiversion",
        "no_multiversion_generate_tasks",
        "future_git_tag_incompatible",
      ]
    commands:
      - func: "generate resmoke tasks"

  # Only run hot_backups tests for hot_backups variant.
  - <<: *gen_task_template
    name: noPassthroughHotBackups_gen
    tags: ["assigned_to_jira_team_server_repl", "experimental"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: no_passthrough
          resmoke_args: src/mongo/db/modules/*/jstests/hot_backups/*.js
          use_large_distro: "true"

  - <<: *gen_task_template
    name: read_concern_linearizable_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "read_write_concern",
        "linearize",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: read_concern_majority_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "read_write_concern",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: replica_sets_api_version_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          fallback_num_sub_suites: 5

  - <<: *gen_task_template
    name: replica_sets_auth_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_debug_mode",
        "replica_sets",
        "common",
        "san",
        "auth",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: replica_sets_fcbis_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "fcbis",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_args: --storageEngine=wiredTiger

  - <<: *gen_task_template
    name: replica_sets_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_debug_mode",
        "replica_sets",
        "san",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_initsync_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "san",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_initsync_lagged_sync_source_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "san",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *task_template
    name: replica_sets_initsync_static_jscore_passthrough
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "san",
        "large",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"

  - <<: *gen_task_template
    name: replica_sets_jscore_multiversion_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "experimental",
        "multiversion",
        "multiversion_passthrough",
      ]
    commands:
      - func: "initialize multiversion tasks"
        vars:
          replica_sets_jscore_passthrough_last_continuous_new_new_old: last_continuous
          replica_sets_jscore_passthrough_last_continuous_new_old_new: last_continuous
          replica_sets_jscore_passthrough_last_continuous_old_new_new: last_continuous
          replica_sets_jscore_passthrough_last_lts_new_new_old: last_lts
          replica_sets_jscore_passthrough_last_lts_new_old_new: last_lts
          replica_sets_jscore_passthrough_last_lts_old_new_new: last_lts
      - func: "generate resmoke tasks"
        vars:
          run_no_feature_flag_tests: "true"

  - <<: *gen_task_template
    name: replica_sets_kill_primary_jscore_multiversion_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "experimental",
        "multiversion",
        "multiversion_passthrough",
      ]
    commands:
      - func: "initialize multiversion tasks"
        vars:
          replica_sets_kill_primary_jscore_passthrough_last_lts_new_new_old: last_lts
          replica_sets_kill_primary_jscore_passthrough_last_lts_new_old_old: last_lts
      - func: "generate resmoke tasks"
        vars:
          run_no_feature_flag_tests: "true"

  - <<: *gen_task_template
    name: replica_sets_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_debug_mode",
        "replica_sets",
        "common",
        "san",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: replica_sets_jscore_passthrough_with_replica_set_endpoint_gen
    tags:
      [
        "assigned_to_jira_team_server_cluster_scalability",
        "default",
        "replica_set_endpoint",
        "requires_all_feature_flags",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_kill_primary_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "large",
        "non_maj_read",
        "non_live_record",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_kill_secondaries_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "san",
        "large",
        "non_live_record",
        "ignore_on_code_coverage",
      ]
    commands:
      - func: "generate resmoke tasks"
        # The hardcoded timeout is to overrule history-based timeout after test number increases,
        # which could be removed after gaining enough history for the new tests.
        vars:
          exec_timeout_secs: 4800 # 80min
          timeout_secs: 4800 # 80min

  - <<: *gen_task_template
    name: replica_sets_lag_oplog_application_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "replica_sets",
        "common",
        "san",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: replica_sets_large_txns_format_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_debug_mode",
        "replica_sets",
        "multi_oplog",
        "large",
        "non_maj_read",
        "san",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: replica_sets_max_mirroring_large_txns_format_gen
    tags: ["assigned_to_jira_team_server_repl", "default"]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_multi_stmt_txn_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_multi_stmt_txn_kill_primary_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "non_maj_read",
        "non_live_record",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_multi_stmt_txn_stepdown_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "non_maj_read",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *task_template
    name: replica_sets_multi_stmt_txn_terminate_primary_jscore_passthrough
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "non_maj_read",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"

  - <<: *gen_task_template
    name: replica_sets_multiversion_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "random_multiversion_ds",
        "multiversion",
      ]
    commands:
      - func: "initialize multiversion tasks"
        vars:
          replica_sets_last_lts: last_lts
          replica_sets_last_continuous: last_continuous
      - func: "generate resmoke tasks"
        vars:
          run_no_feature_flag_tests: "true"

  - <<: *gen_task_template
    name: replica_sets_reconfig_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: replica_sets_reconfig_jscore_stepdown_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default"]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_reconfig_kill_primary_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default"]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_recordids_replicated_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "requires_all_feature_flags",
        "recordids_replicated",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_terminate_primary_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "large",
        "non_maj_read",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: replica_sets_uninitialized_fcv_jscore_passthrough_gen
    # TODO(SERVER-69951) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "incompatible_debug_mode",
        "replica_sets",
        "san",
        "large",
        "uninitialized_fcv",
      ]
    commands:
      - func: "generate resmoke tasks"

  ## rollback generational fuzzer with clean shutdowns ##
  - <<: *jstestfuzz_template
    name: rollback_fuzzer_clean_shutdowns_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "non_deterministic",
        "rollbackfuzzer",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: 1
          num_tasks: 4
          jstestfuzz_vars: --numLinesPerFile 300 --maxLinesBetweenEvents 50 --useEsModules
          npm_command: rollback-fuzzer
          suite: rollback_fuzzer_clean_shutdowns
          # Rollback suites create indexes with majority of nodes not available for replication. So, disabling
          # index build commit quorum.
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}, enableIndexBuildCommitQuorum: false}'"

  ## rollback generational fuzzer to ensure stability in patch builds ##
  - <<: *jstestfuzz_template
    name: rollback_fuzzer_sanity_patch_gen
    patch_only: true
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "default",
        "rollbackfuzzer",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars: &rollback_fuzzer_sanity_patch_config
          <<: *jstestfuzz_config_vars
          num_files: 2
          num_tasks: 1
          jstestfuzz_vars: --useEsModules
          npm_command: rollback-fuzzer
          suite: rollback_fuzzer
          # Rollback suites create indexes with majority of nodes not available for replication. So, disabling
          # index build commit quorum.
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}, enableIndexBuildCommitQuorum: false}'"

  ## rollback generational fuzzer ##
  - <<: *jstestfuzz_template
    name: rollback_fuzzer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "non_deterministic",
        "rollbackfuzzer",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *rollback_fuzzer_sanity_patch_config
          num_files: 3
          num_tasks: 5

  ## rollback generational fuzzer with unclean shutdowns ##
  - <<: *jstestfuzz_template
    name: rollback_fuzzer_unclean_shutdowns_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "non_deterministic",
        "rollbackfuzzer",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: 1
          num_tasks: 4
          jstestfuzz_vars: --numLinesPerFile 300 --maxLinesBetweenEvents 50 --useEsModules
          npm_command: rollback-fuzzer
          suite: rollback_fuzzer_unclean_shutdowns
          # Rollback suites create indexes with majority of nodes not available for replication. So, disabling
          # index build commit quorum.
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}, enableIndexBuildCommitQuorum: false}'"

  ## rollback multiversion fuzzer ##
  - <<: *jstestfuzz_template
    name: rollback_multiversion_fuzzer_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "experimental",
        "multiversion_fuzzer",
        "require_npm",
        "random_name",
        "multiversion",
      ]
    commands:
      - func: "initialize multiversion tasks"
        vars:
          rollback_fuzzer_last_lts: last_lts
          rollback_fuzzer_last_continuous: last_continuous
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: 3
          num_tasks: 5
          jstestfuzz_vars: --useEsModules
          npm_command: rollback-fuzzer
          # Rollback suites create indexes with majority of nodes not available for replication. So, disabling
          # index build commit quorum.
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}, enableIndexBuildCommitQuorum: false}'"
          run_no_feature_flag_tests: "true"

  - <<: *gen_task_template
    name: secondary_reads_passthrough_gen
    tags: ["assigned_to_jira_team_server_repl", "default"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: secondary_reads_passthrough_with_replica_set_endpoint_gen
    tags:
      [
        "assigned_to_jira_team_server_cluster_scalability",
        "experimental",
        "replica_set_endpoint",
        "requires_all_feature_flags",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *task_template
    name: serial_run
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "misc_js",
        "non_win_dbg",
        "requires_large_host",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: sharded_causally_consistent_read_concern_snapshot_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "causally_consistent",
        "read_write_concern",
        "durable_history",
      ]
    commands:
      - func: "generate resmoke tasks"

  - <<: *gen_task_template
    name: sharded_collections_uninitialized_fcv_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_windows",
        "sharding",
        "jscore",
        "initsync",
        "uninitialized_fcv",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_xlarge_distro: "true"

  - <<: *gen_task_template
    name: sharded_collections_txns_uninitialized_fcv_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_windows",
        "sharding",
        "jscore",
        "initsync",
        "uninitialized_fcv",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_xlarge_distro: "true"

  - <<: *gen_task_template
    name: sharding_api_version_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "sharding",
        "jscore",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          fallback_num_sub_suites: 5

  - <<: *gen_task_template
    name: sharding_uninitialized_fcv_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_windows",
        "sharding",
        "jscore",
        "initsync",
        "uninitialized_fcv",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_xlarge_distro: "true"

  - <<: *gen_task_template
    name: sharding_txns_uninitialized_fcv_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_repl",
        "release_critical",
        "incompatible_mac",
        "incompatible_windows",
        "sharding",
        "jscore",
        "initsync",
        "uninitialized_fcv",
        "large",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_xlarge_distro: "true"

  - name: tla_plus
    tags: ["assigned_to_jira_team_server_repl", "experimental"]
    commands:
      - func: "f_expansions_write"
      - func: "do non-compile setup"
      - command: subprocess.exec
        type: setup
        params:
          binary: bash
          args:
            - "./src/evergreen/download_tlc.sh"
      - func: "run tests"
        vars:
          resmoke_jobs_max: 1

  # TODO(SERVER-89135): Fix this passthrough with causal consistency or remove it.
  # Disable this test due to wrong secondary read after majority write assumption.
  # - <<: *gen_task_template
  #   name: write_concern_majority_passthrough_gen
  #   tags:
  #     [
  #       "assigned_to_jira_team_server_repl",
  #       "release_critical",
  #       "incompatible_mac",
  #       "incompatible_all_feature_flags",
  #       "read_write_concern",
  #       "large",
  #       "write",
  #       "secondary_read_after_majority_write",
  #     ]
  #   commands:
  #     - func: "generate resmoke tasks"
  #       vars:
  #         use_large_distro: "true"

  ################################################
  #           Storage Execution tasks            #
  ################################################

  - <<: *gen_task_template
    name: clustered_collection_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "large",
        "clustered_collections",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: concurrency_metrics_gen
    tags: ["assigned_to_jira_team_server_execution", "default", "concurrency"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_replication_metrics_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "concurrency",
        "repl",
        "disabled_on_code_coverage",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_replication_metrics_with_replica_set_endpoint_gen
    tags:
      [
        "assigned_to_jira_team_server_cluster_scalability",
        "experimental",
        "replica_set_endpoint",
        "requires_all_feature_flags",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: concurrency_simultaneous_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "concurrency",
        "common",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: config_fuzzer_concurrency_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "concurrency",
        "config_fuzzer",
        "default",
        "large",
        "incompatible_tsan",
        "incompatible_aubsan",
        "incompatible_debug_mode",
        "incompatible_inmemory",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: concurrency_replication
          resmoke_args: >-
            --fuzzMongodConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer
          use_large_distro: "true"

  - <<: *gen_task_template
    name: config_fuzzer_jstestfuzz_concurrent_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "config_fuzzer",
        "incompatible_aubsan",
        "incompatible_debug_mode",
        "incompatible_inmemory",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_tsan",
        "jstestfuzz",
        "non_deterministic",
        "require_npm",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: ${jstestfuzz_concurrent_num_files|10}
          num_tasks: 5
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_replication
          resmoke_args: >-
            --numClientsPerFixture=10
            --fuzzMongodConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer

  - <<: *gen_task_template
    name: config_fuzzer_concurrency_sharded_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "concurrency",
        "config_fuzzer",
        "default",
        "large",
        "sharded",
        "incompatible_tsan",
        "incompatible_aubsan",
        "incompatible_debug_mode",
        "incompatible_inmemory",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: concurrency_sharded_replication
          resmoke_args: >-
            --fuzzMongodConfigs=normal
            --fuzzMongosConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer
          use_xlarge_distro: "true"
          resmoke_jobs_max: 1

  - <<: *gen_task_template
    name: config_fuzzer_concurrency_simultaneous_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "concurrency",
        "config_fuzzer",
        "default",
        "large",
        "incompatible_tsan",
        "incompatible_aubsan",
        "incompatible_debug_mode",
        "incompatible_inmemory",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: concurrency_simultaneous_replication
          resmoke_args: >-
            --fuzzMongodConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer
          use_large_distro: "true"

  - <<: *task_template
    name: config_fuzzer_jsCore
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "config_fuzzer",
        "incompatible_inmemory",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"
        vars:
          suite: core
          resmoke_args: >-
            --fuzzMongodConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer

  - <<: *gen_task_template
    name: config_fuzzer_replica_sets_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "config_fuzzer",
        "large",
        "incompatible_tsan",
        "incompatible_aubsan",
        "incompatible_debug_mode",
        "incompatible_inmemory",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: replica_sets_jscore_passthrough
          resmoke_args: >-
            --fuzzMongodConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer
          use_large_distro: "true"

  - <<: *gen_task_template
    name: config_fuzzer_sharding_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "config_fuzzer",
        "large",
        "incompatible_tsan",
        "incompatible_aubsan",
        "incompatible_debug_mode",
        "incompatible_inmemory",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: sharding_jscore_passthrough
          resmoke_args: >-
            --fuzzMongodConfigs=normal
            --fuzzMongosConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer
          use_large_distro: "true"

  - <<: *gen_task_template
    name: config_fuzzer_simulate_crash_concurrency_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "config_fuzzer",
        "large",
        "linux_only",
        "incompatible_tsan",
        "incompatible_aubsan",
        "incompatible_debug_mode",
        "incompatible_inmemory",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: simulate_crash_concurrency_replication
          # We disable encryption fuzzing because it increases the runtime of this task
          # significantly (over 5x in testing). It does not cause correctness issues.
          resmoke_args: >-
            --fuzzMongodConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer
            --disableEncryptionFuzzing
          use_large_distro: "true"

  - <<: *gen_task_template
    name: config_fuzzer_stress_concurrency_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "config_fuzzer_stress",
        "incompatible_tsan",
        "incompatible_aubsan",
        "incompatible_debug_mode",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: concurrency_replication
          resmoke_args: >-
            --fuzzMongodConfigs=stress
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer
          use_large_distro: "true"
          exec_timeout_secs: 14400 # 4 hours
          timeout_secs: 14400 # 4 hours

  - <<: *gen_task_template
    name: config_fuzzer_stress_concurrency_sharded_replication_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "config_fuzzer_stress",
        "incompatible_tsan",
        "incompatible_aubsan",
        "incompatible_debug_mode",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: concurrency_sharded_replication
          resmoke_args: >-
            --fuzzMongodConfigs=stress
            --fuzzMongosConfigs=normal
            --fuzzRuntimeParams
            --excludeWithAnyTags=does_not_support_config_fuzzer
          use_large_distro: "true"
          exec_timeout_secs: 14400 # 4 hours
          timeout_secs: 14400 # 4 hours
          resmoke_jobs_max: 1

  - <<: *task_template
    name: disk_wiredtiger
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "release_critical",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_aubsan",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"
        vars:
          resmoke_jobs_max: 1

  - <<: *task_template
    name: jsCore_decimal
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "release_critical",
        "jscore",
        "common",
        "decimal",
      ]
    commands:
      - func: "do setup"
      - func: "run tests"
        vars:
          suite: decimal

  ## jstestfuzz concurrent ##
  - <<: *jstestfuzz_template
    name: jstestfuzz_concurrent_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "common",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          num_files: ${jstestfuzz_concurrent_num_files|10}
          num_tasks: 5
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz
          resmoke_args: --numClientsPerFixture=10

  # jstestfuzz interrupt #
  - <<: *jstestfuzz_template
    name: jstestfuzz_interrupt_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "interrupt",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_interrupt
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"

  # jstestfuzz interrupt #
  - <<: *jstestfuzz_template
    name: jstestfuzz_interrupt_replication_gen
    # TODO(SERVER-69996) remove "incompatible_debug_mode" tag
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "incompatible_debug_mode",
        "jstestfuzz",
        "non_deterministic",
        "interrupt",
        "require_npm",
        "random_name",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          <<: *jstestfuzz_config_vars
          jstestfuzz_vars: --jsTestsDir ../jstests
          suite: jstestfuzz_interrupt_replication
          resmoke_args: "--mongodSetParameters='{logComponentVerbosity: {command: 2}}'"

  - <<: *gen_task_template
    name: noPassthroughWithMongod_gen
    tags:
      ["assigned_to_jira_team_server_execution", "release_critical", "misc_js"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: no_passthrough_with_mongod
          use_large_distro: "true"

  - <<: *gen_task_template
    name: noPassthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "release_critical",
        "incompatible_mac",
        "incompatible_ppc",
        "incompatible_s390x",
        "incompatible_debug_mode",
        "misc_js",
        "requires_execution_on_windows_patch_build",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: no_passthrough
          use_large_distro: "true"

  - <<: *task_template
    name: read_only
    tags: ["assigned_to_jira_team_server_execution", "default", "read_only"]
    commands:
      - func: "do setup"
      - func: "run tests"

  - <<: *task_template
    name: read_only_sharded
    tags: ["assigned_to_jira_team_server_execution", "default", "read_only"]
    commands:
      - func: "do setup"
      - func: "run tests"

  - <<: *gen_task_template
    name: sharding_clustered_collections_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "default",
        "large",
        "clustered_collections",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          use_large_distro: "true"

  - <<: *gen_task_template
    name: slow1_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "release_critical",
        "misc_js",
        "non_win_dbg",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          resmoke_jobs_max: 1
          use_large_distro: "true"

  - <<: *gen_task_template
    name: timeseries_crud_jscore_passthrough_gen
    tags:
      [
        "assigned_to_jira_team_server_execution",
        "release_critical",
        "incompatible_mac",
        "timeseries_crud",
      ]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: timeseries_crud_jscore_passthrough

  - <<: *gen_task_template
    name: v1index_jscore_passthrough_gen
    tags: ["assigned_to_jira_team_server_execution", "default"]
    commands:
      - func: "generate resmoke tasks"
        vars:
          suite: v1index_jscore_passthrough
