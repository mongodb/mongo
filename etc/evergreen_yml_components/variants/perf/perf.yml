variables:
- &amazon2_x86_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: amazon2-x86-compile

- &amazon2_x86_openssl111_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: amazon2-x86-openssl111-compile

- &amazon_linux2_arm64_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: amazon2-arm64-compile

- &amazon_linux2_x86_streams_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: amazon2-x86-streams-compile

- &amazon_linux2_arm64_mongocrypt_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: amazon2-arm64-compile
  - name: compile_mongocrypt_shlib
    variant: amazon2-arm64-mongocrypt-shlib-compile

- &al2023_arm64_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: al2023-arm64-compile

- &al2023_al2_arm64_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: al2023-arm64-compile
  - name: package_new_compile
    variant: amazon2-arm64-compile

- &amazon2_x86_expansions
  multiversion_platform: amazon2
  multiversion_edition: enterprise
  repo_edition: enterprise
  num_scons_link_jobs_available: 0.99

- &schedule_variant_auto_tasks_task
  name: schedule_variant_auto_tasks
  activate: false
  depends_on:
    - name: schedule_global_auto_tasks
      variant: task_generation

- &schedule_patch_auto_tasks_task
  name: schedule_patch_auto_tasks
  activate: false
  depends_on:
    - name: schedule_global_auto_tasks
      variant: task_generation


# THIS HAS COPIES IN:
# - etc/evergreen_yml_components/variants/perf/perf_branching.yml
# - etc/evergreen_yml_components/variants/amazon/test_dev_master_branch_only.yml
# - etc/evergreen_yml_components/variants/amazon/test_dev.yml
# ANY MODIFICATIONS HERE SHOULD ALSO BE MADE IN THOSE FILES
- &linux_arm64_generic_expansions
  multiversion_platform: amazon2
  multiversion_edition: enterprise
  multiversion_architecture: aarch64
  packager_arch: aarch64
  packager_distro: amazon2
  repo_edition: enterprise
  large_distro_name: amazon2-arm64-large
  core_analyzer_distro_name: amazon2-arm64-xlarge
  num_scons_link_jobs_available: 0.99

- modules: &perf_modules
    - enterprise
    - dsi
    - genny
    - workloads
    - linkbench
    - linkbench2
    - tsbs
    - mongo-perf
    - YCSB
    - PrivateWorkloads
    - py-tpcc
    - flamegraph

buildvariants:
- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet ARM AWS 2023-11
  cron: &linux-1-node-repl-cron "0 0 * * 4" # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    <<: *linux_arm64_generic_expansions
    idle_timeout_factor: 1.5
    exec_timeout_factor: 1.5
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: &perf_project_dir dsi
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - rhel70-small
  tasks: &1nodetasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_single_thread
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: crud_workloads_majority
    - name: misc_workloads
    - name: map_reduce_workloads
    - name: smoke_test
    - name: canaries_only
    - name: non_sharded_workloads
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: change_streams_latency
    - name: change_streams_listen_throughput
    - name: snapshot_reads
    - name: linkbench
    - name: linkbench2
    - name: tsbs_load
    - name: tsbs_query
    - name: tsbs_query_finance
    - name: tsbs_query_manual_bucketing
    - name: tsbs_query_fixed_bucketing
    - name: tsbs-query-genny
    - name: tsbs-query-optimizations
    - name: tpcc
    - name: tpcc_majority
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    - name: tpch_10_normalized
    - name: tpch_10_denormalized
    - name: genny_execution_ValidationFull

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-standalone-classic-query-engine.intel.aws.2023-11
  display_name: PERF Standalone (Classic Query Engine) Intel AWS 2023-11
  cron: &cron_query_perf_schedule "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    <<: *amazon2_x86_expansions
    idle_timeout_factor: 1.5
    exec_timeout_factor: 1.5
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-classic-query-engine
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - amazon2
  tasks: &classic_engine_tasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_single_thread
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: crud_workloads_majority
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: cursor_manager
    - name: map_reduce_workloads
    - name: tpcc
    - name: tpcc_majority
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    - name: tpch_10_normalized
    - name: tpch_10_denormalized
    - name: canaries_only

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-standalone-sbe.intel.aws.2023-11
  display_name: PERF Standalone (SBE) Intel AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-sbe
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *classic_engine_tasks

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-1-node-replSet-classic-query-engine.intel.aws.2023-11
  display_name: PERF Intel 1-Node ReplSet (Classic Query Engine) Intel AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-classic-query-engine
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-single"
  tasks: &classic_engine_1nodereplset_tasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: linkbench
    - name: linkbench2
    - name: snapshot_reads
    - name: canaries_only

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-1-node-replSet-sbe.intel.aws.2023-11
  display_name: PERF 1-Node ReplSet (SBE) Intel AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-sbe
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *classic_engine_1nodereplset_tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-lite-all-feature-flags.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet (graviton lite, all FF) ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    workload_setup: 2022-11
    mongodb_setup: single-replica-all-feature-flags
    infrastructure_provisioning: graviton-single-lite.2022-11
    infrastructure_provisioning_release: 2023-09
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: bestbuy_4_analytics
    - name: bestbuy_4_analytics_columnstore
    - name: bestbuy_4_inserts
    - name: column_store_index_charts_events_1G
    - name: column_store_index_charts_events_10G
    - name: column_store_tpch_10_denormalized
    - name: column_store_tpch_10_denormalized_unindexed
    - name: ssb_column_store_comparison

- <<: *al2023_al2_arm64_compile_variant_dependency
  name: atlas-like-replica.2023-09
  display_name: PERF M60-like-replica.2023-09 3-Node ReplSet
  cron: &atlas-like-repl-cron "0 0 * * 0,4"  # 00:00 on Sunday,Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup: atlas-like-replica.2023-09
    mongodb_setup_release: 2022-11
    infrastructure_provisioning: M60-like-replica.2023-09
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: al2023-arm64-compile
    client_compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-M60-like"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_single_thread
    - name: ycsb_60GB.2023-09
    - name: tpcc
    - name: tpcc_majority
    - name: linkbench
    - name: linkbench2
    # - name: genny_query_TenMDocCollection_IntId
    # - name: genny_query_TenMDocCollection_ObjectId
    # - name: genny_query_TenMDocCollection_SubDocId
    # - name: genny_query_TenMDocCollection_IntId_Agg
    # - name: genny_query_TenMDocCollection_IntId_IdentityView
    # - name: genny_query_TenMDocCollection_IntId_IdentityView_Agg

- <<: *al2023_al2_arm64_compile_variant_dependency
  name: atlas-like-replica.west.2024-02
  display_name: PERF M60-like-replica-West.2024-02 3-Node ReplSet
  cron: "0 0 * * 0,4"  # 00:00 on Sunday,Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup: atlas-like-replica.2023-09
    mongodb_setup_release: 2022-11
    infrastructure_provisioning: M60-like-replica-west.2024-02
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: al2023-arm64-compile
    client_compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-M60-like"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
      cron: &high-value-workload-cron "0 */4 * * 1-5" # High-value workloads run every weekday, every 4 hours
    - name: ycsb_single_thread
    - name: ycsb_60GB.2023-09
      cron: *high-value-workload-cron
    - name: ycsb_60GB.long.2023-09
      cron: *high-value-workload-cron
    - name: bestbuy_agg
    - name: tpcc
    - name: tpcc_majority
    - name: linkbench
    - name: linkbench2
    - name: tsbs_load
    - name: tsbs_query
    - name: mixed_workloads_genny_rate_limited_high_value
    - name: load_test_high_value
    - name: majority_reads10_k_threads_high_value
    - name: large_indexed_ins_high_value
    - name: expressive_queries_high_value
    - name: time_series_sort_high_value
    # - name: genny_query_TenMDocCollection_IntId
    # - name: genny_query_TenMDocCollection_ObjectId
    # - name: genny_query_TenMDocCollection_SubDocId
    # - name: genny_query_TenMDocCollection_IntId_Agg
    # - name: genny_query_TenMDocCollection_IntId_IdentityView
    # - name: genny_query_TenMDocCollection_IntId_IdentityView_Agg

- <<: *amazon2_x86_openssl111_compile_variant_dependency
  name: atlas-like-replica-intel-openSSL-111.2023-09
  display_name: PERF M60-like-replica.2023-09 Intel OpenSSL 1.1.1 3-Node ReplSet
  cron: *atlas-like-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup: atlas-like-replica-openssl11.2023-09
    mongodb_setup_release: 2022-11
    infrastructure_provisioning: M60-like-replica-intel.2023-09
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-openssl111-compile
  run_on:
    - "rhel70-perf-M60-like"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_single_thread
    - name: ycsb_60GB.2023-09
    - name: tpcc
    - name: tpcc_majority
    - name: linkbench
    - name: linkbench2

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-atlas-M30-real.arm.aws.2023-11
  display_name: PERF M30-Atlas ReplSet ARM AWS 2023-11
  cron: &cron_sunday_thursday "0 0 * * 0,4"
  modules: *perf_modules
  expansions:
    mongodb_setup: atlas
    canaries: none
    atlas_setup: M30-repl
    use_custom_build: true
    infrastructure_provisioning: workload_client_arm.2023-04
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-atlas-large"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_single_thread
    - name: tpcc
    - name: linkbench2

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-atlas-M60-shard-real-multi-client.arm.aws.2023-11
  display_name: PERF M60-Shard Atlas Multiple Workload Clients ARM AWS 2023-11
  cron: *cron_sunday_thursday
  modules: *perf_modules
  expansions:
    mongodb_setup: atlas-shard
    canaries: none
    atlas_setup: M60-shard
    use_custom_build: true
    infrastructure_provisioning: workload_client_multiple.arm.2023-09
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-atlas-large"
  tasks:
    - name: locust_bulk_insert

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-standalone-all-feature-flags.arm.aws.2023-11
  display_name: PERF Standalone (all feature flags) ARM AWS 2023-11
  cron: &linux-standalone-cron "0 0 * * 2,4,6"  # Tuesday, Thursday and Saturday at 00:00
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-all-feature-flags
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: crud_workloads_majority
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_4_analytics
    - name: bestbuy_4_analytics_columnstore
    - name: bestbuy_4_inserts
    - name: bestbuy_query
    - name: cursor_manager
    - name: map_reduce_workloads
    - name: tpcc
    - name: tpcc_majority
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    - name: tpch_10_normalized
    - name: tpch_10_denormalized
    - name: column_store_index_charts_events_1G
    - name: column_store_tpch_10_denormalized
    - name: column_store_tpch_10_denormalized_unindexed
    - name: ssb_column_store_comparison

- <<: *amazon_linux2_x86_streams_compile_variant_dependency
  name: perf-streams-single.intel.aws.2023-10
  display_name: PERF Streams-Single Intel AWS 2023-10
  # cron: "0 0 * * 2,4,6"  # Tuesday, Thursday and Saturday at 00:00
  modules: *perf_modules
  expansions:
    compile_variant: amazon2-x86-streams-compile
    requires_mongostream: true
    mongodb_setup_release: 2022-11
    mongodb_setup: streams-single.2023-10
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: streams-single.intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: stream_workloads

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-standalone-classic-query-engine.arm.aws.2023-11
  display_name: PERF Standalone (Classic Query Engine) ARM AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-classic-query-engine
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *classic_engine_tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-standalone-sbe.arm.aws.2023-11
  display_name: PERF Standalone (SBE) ARM AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-sbe
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *classic_engine_tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-standalone-sampling-bonsai.arm.aws.2023-11
  display_name: PERF Standalone (Bonsai with Sampling CE) ARM AWS 2023-11
  cron: "0 0 * * 0"  # Run it only on Sunday.
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-sampling-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: &bonsai_standalone_tasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-standalone-sampling-bonsai.intel.aws.2023-11
  display_name: PERF Standalone (Bonsai with Sampling CE) Intel AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-sampling-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *bonsai_standalone_tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-standalone-heuristic-bonsai.arm.aws.2023-11
  display_name: PERF Standalone (Bonsai with Heuristic CE) ARM AWS 2023-11
  cron: "0 0 * * 0"  # Run it only on Sunday.
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-heuristic-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *bonsai_standalone_tasks

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-standalone-heuristic-bonsai.intel.aws.2023-11
  display_name: PERF Standalone (Bonsai with Heuristic CE) Intel AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-heuristic-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *bonsai_standalone_tasks

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-1-node-replSet-sampling-bonsai.intel.aws.2023-11
  display_name: PERF 1-Node ReplSet (Bonsai with Sampling CE) Intel AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-sampling-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-single"
  tasks: &bonsai_1nodereplset_tasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: linkbench2
    - name: snapshot_reads

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-sampling-bonsai.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet (Bonsai with Sampling CE) ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-sampling-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *bonsai_1nodereplset_tasks

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-1-node-replSet-heuristic-bonsai.intel.aws.2023-11
  display_name: PERF 1-Node ReplSet (Bonsai with Heuristic CE) Intel AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-heuristic-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *bonsai_1nodereplset_tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-heuristic-bonsai.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet (Bonsai with Heuristic CE) ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-heuristic-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *bonsai_1nodereplset_tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-classic-query-engine.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet (Classic Query Engine) ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-classic-query-engine
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *classic_engine_1nodereplset_tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-sbe.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet (SBE) ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-sbe
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *classic_engine_1nodereplset_tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-all-feature-flags.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet (all feature flags) ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-all-feature-flags
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: linkbench
    - name: linkbench2

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-test-commands.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet With Test Commands ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    # Needed to allow enabling failpoints.
    config_params_json: &config_params_enableTestCommmands '{"v":0, "enableTestCommands": true}'
  run_on:
    - "rhel70-perf-single"
  tasks: &1node-test-commands-tasks
    - name: startup

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-standalone-audit.arm.aws.2023-11
  display_name: PERF Standalone Audit ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-audit
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: &audit-tasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: crud_workloads_majority
    - name: smoke_test

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-audit-log-encryption-no-compression.arm.aws.2023-11
  display_name: PERF Single-node Replica Set Audit w/ At-Rest Log Encryption (No compression) ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-audit-log-encryption-no-compression
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *audit-tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-audit.arm.aws.2023-11
  display_name: PERF Single-node Replica Set Audit ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-audit
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *audit-tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-audit-log-encryption-compression.arm.aws.2023-11
  display_name: PERF Single-node Replica Set Audit w/ At-Rest Log Encryption (With compression) ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-audit-log-encryption-compression
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: *audit-tasks

- <<: *amazon_linux2_arm64_mongocrypt_compile_variant_dependency
  name: perf-1-node-replSet-fle.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet FLE ARM AWS 2023-11
  cron: *cron_sunday_thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-fle
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    fle: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    requires_mongocrypt_shlib: true
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: linkbench

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-ese-cbc.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet ESE CBC ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-ese-cbc
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: smoke_test
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-ese-gcm.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet ESE GCM ARM AWS 2023-11
  cron: "0 0 1 * *"  # 00:00 on the first of each month
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-ese-gcm
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: smoke_test
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-15gbwtcache.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet 15 GB WiredTiger Cache ARM AWS 2023-11
  cron: "0 0 * * 2,4"  # 00:00 on Tuesday,Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-15gbwtcache
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: smoke_test
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-1dayhistory-15gbwtcache.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet 1 Day History 15 GB WiredTiger Cache ARM AWS 2023-11
  cron: *cron_sunday_thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-1dayhistory-15gbwtcache
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: crud_workloads_majority
    - name: crud_workloads_w1
    - name: smoke_test
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-shard-heuristic-bonsai.arm.aws.2023-11
  display_name: PERF 3-Shard Cluster (Bonsai with Heuristic CE) ARM AWS 2023-11
  cron: &linux-3-shard-cron "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-heuristic-bonsai
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_w1.2023-09

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-shard-lite-audit.arm.aws.2023-11
  display_name: PERF Shard Lite Cluster Audit ARM AWS 2023-11
  cron: *cron_sunday_thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-lite-audit
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard-lite-audit
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard-lite"
  tasks:
    - name: ycsb.2023-09

- &shard-lite-baseline
  <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-shard-lite.arm.aws.2023-11
  display_name: PERF Shard Lite Cluster ARM AWS 2023-11
  cron: *cron_sunday_thursday
  modules: *perf_modules
  expansions: &shard-lite-baseline-expansions
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-lite
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard-lite
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard-lite"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_target_hashed
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: change_streams_latency
    - name: change_streams_preimage_latency
    - name: change_streams_preimage_throughput
    - name: change_streams_listen_throughput
    - name: ycsb.2023-09
    - name: linkbench
    - name: mongos_workloads
    - name: mongos_large_catalog_workloads
    - name: move_chunk_large_chunk_map_workloads
    - name: move_chunk_workloads
    - name: move_chunk_waiting_workloads
    - name: smoke_test
    - name: tsbs_query_sharded
    - name: tsbs_query_finance_sharded
    - name: tsbs_query_sharded_balancer
    - name: tsbs_query_finance_sharded_balancer

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-shard-lite-intel.intel.aws.2023-11
  display_name: PERF Shard Lite Cluster Intel AWS 2023-11
  cron: *cron_sunday_thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-lite
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard-lite-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-shard-lite"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: mongos_workloads
    - name: move_chunk_workloads
    - name: move_chunk_waiting_workloads
    - name: smoke_test

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-shard-lite-read-concern-available.arm.aws.2023-11
  display_name: PERF Shard Lite ReadConcern Available ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-lite-read-concern-available
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard-lite
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard-lite"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: linkbench

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-shard-lite-all-feature-flags.arm.aws.2023-11
  display_name: PERF Shard Lite (all feature flags) ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-lite-all-feature-flags
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard-lite
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard-lite"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: change_streams_preimage_throughput
    - name: change_streams_preimage_latency
    - name: tsbs_query_sharded
    - name: tsbs_query_finance_sharded
    - name: tsbs_query_sharded_balancer
    - name: tsbs_query_finance_sharded_balancer

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-shard-single.arm.aws.2023-11
  display_name: PERF Shard Single ARM AWS 2023-11
  cron: "0 0 * * 2,4"  # 00:00 on Tuesday,Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-single
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard-single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard-lite"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-last-continuous-fcv.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (Last Continuous FCV) ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-last-continuous-fcv
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: ycsb_secondary_reads.2023-09
    - name: ycsb_w1.2023-09
    - name: crud_workloads_majority
    - name: crud_workloads_w1
    - name: misc_workloads
    - name: map_reduce_workloads
    - name: refine_shard_key_transaction_stress
    - name: smoke_test
    - name: secondary_performance # Uses a special 2 node mongodb setup
    - name: non_sharded_workloads
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: change_streams_latency
    - name: change_streams_listen_throughput
    - name: snapshot_reads
    - name: secondary_reads
    - name: tpcc
    - name: tpcc_majority
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    # TODO: Enable in SERVER-66572.
    # - name: tpch_10_normalized
    # - name: tpch_10_denormalized
    - name: linkbench
    - name: linkbench2
    - name: tsbs_load
    - name: tsbs_query
    - name: tsbs_query_finance
    - name: tsbs_query_manual_bucketing
    - name: tsbs_query_fixed_bucketing
    - name: tsbs-query-genny
    - name: tsbs-query-optimizations

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-last-lts-fcv.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (Last LTS FCV) ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-last-lts-fcv
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: ycsb_secondary_reads.2023-09
    - name: ycsb_w1.2023-09
    - name: crud_workloads_majority
    - name: crud_workloads_w1
    - name: misc_workloads
    - name: map_reduce_workloads
    - name: refine_shard_key_transaction_stress
    - name: smoke_test
    - name: secondary_performance # Uses a special 2 node mongodb setup
    - name: non_sharded_workloads
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: change_streams_latency
    - name: change_streams_listen_throughput
    - name: snapshot_reads
    - name: secondary_reads
    - name: tpcc
    - name: tpcc_majority
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    # TODO: Enable in SERVER-66572.
    # - name: tpch_10_normalized
    # - name: tpch_10_denormalized
    - name: linkbench
    - name: linkbench2
    - name: tsbs_load
    - name: tsbs_query
    - name: tsbs_query_finance
    - name: tsbs_query_manual_bucketing
    - name: tsbs_query_fixed_bucketing
    - name: tsbs-query-genny
    - name: tsbs-query-optimizations

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-all-feature-flags.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (all feature flags) ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-all-feature-flags
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: ycsb_secondary_reads.2023-09
    - name: ycsb_w1.2023-09
    - name: crud_workloads_majority
    - name: crud_workloads_w1
    - name: misc_workloads
    - name: map_reduce_workloads
    - name: refine_shard_key_transaction_stress
    - name: smoke_test
    - name: secondary_performance # Uses a special 2 node mongodb setup
    - name: non_sharded_workloads
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: change_streams_latency
    - name: change_streams_listen_throughput
    - name: change_streams_preimage_throughput
    - name: change_streams_preimage_latency
    - name: snapshot_reads
    - name: secondary_reads
    - name: tpcc
    - name: tpcc_majority
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    # TODO: Enable in SERVER-66572.
    # - name: tpch_10_normalized
    # - name: tpch_10_denormalized
    - name: linkbench
    - name: linkbench2
    - name: tsbs_load
    - name: tsbs_query
    - name: tsbs_query_finance
    - name: tsbs_query_manual_bucketing
    - name: tsbs_query_fixed_bucketing
    - name: tsbs-query-genny
    - name: tsbs-query-optimizations
    - name: tsbs-expression-query
    - name: dbcheck

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-notls.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (No TLS) ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup: replica-tls-disabled
    mongodb_setup_release: 2022-11
    infrastructure_provisioning: replica
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: crud_workloads_majority
    - name: ycsb.2023-09

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-maintenance-events.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (Maintenance Events) ARM AWS 2023-11
  cron: *cron_sunday_thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-maintenance-events
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    platform: linux
    workload_setup: 2022-11
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb_stepdowns.2023-09
    - name: ycsb_rolling_restarts.2023-09
    - name: ycsb_non_retryable_writes_stepdowns.2023-09
    - name: ycsb_non_retryable_writes_rolling_restarts.2023-09
    - name: linkbench_stepdowns
    - name: linkbench_rolling_restarts
    - name: linkbench_non_retryable_writes_stepdowns
    - name: linkbench_non_retryable_writes_rolling_restarts
    - name: mixed_workloads_genny_stepdowns
    - name: mixed_workloads_genny_rolling_restarts

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-replSet-initialsync-logkeeper.arm.aws.2023-11
  display_name: PERF ReplSet Initial Sync LogKeeper ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: initialsync-logkeeper
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: initialsync-logkeeper
    workload_setup: 2022-11
    # EBS logkeeper snapshot with FCV set to 7.2
    snapshotId: snap-042ca2a003313ebc2
    platform: linux
    authentication: disabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    project_dir: *perf_project_dir
  run_on:
    - "rhel70-perf-initialsync-logkeeper"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: initialsync-logkeeper
    - name: initialsync-logkeeper-fcbis

# Uncomment this to run logkeeper FCV updates automatically. This is only intended to be run in
# patch builds.
# - name: linux-replSet-initialsync-logkeeper-snapshot-update
#   display_name: Linux ReplSet Initial Sync LogKeeper Snapshot Update
#   cron: "0 0 * * 4"  # 00:00 on Thursday
#   modules: *modules
#   expansions:
#     mongodb_setup_release: 2022-11
#     mongodb_setup: initialsync-logkeeper-snapshot-update
#     infrastructure_provisioning_release: 2022-11
#     infrastructure_provisioning: initialsync-logkeeper-snapshot-update
#     # Update this to latest snapshot after each LTS release.
#     snapshotId: snap-042ca2a003313ebc2
#     platform: linux
#     authentication: disabled
#     storageEngine: wiredTiger
#     project_dir: *perf_project_dir
#     compile_variant: "-arm64"
#   run_on:
#     - "rhel70-perf-initialsync-logkeeper"
#   depends_on: *_compile_amazon_linux2_arm64
#   tasks:
#     - *schedule_patch_auto_tasks_task
#     - *schedule_variant_auto_tasks_task
#     - name: initialsync-logkeeper-snapshot-update

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-replSet-audit.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet Audit ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-audit
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-replSet-auth-delay.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (Auth Delay) ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-auth-cluster-delay
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-250mbwtcache.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet 250 MB WiredTiger Cache ARM AWS 2023-11
  cron: &linux-3-node-cron "0 0 * * 1,2,3,4,5,6"  # Everyday except Sunday at 00:00
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-250mbwtcache.2023-05
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task

- &linux-mongo-perf-repl-arm
  <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-mongo-perf-repl.arm.aws.2023-11
  display_name: PERF Mongo-Perf 1-Node ReplSet inMemory ARM AWS 2023-11
  cron: "0 0 * * 0,2,3,4,5"  # Run it every day except Saturday and Monday.
  modules: *perf_modules
  expansions: &repl-arm-expansions
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-replica.2023-02
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined.2023-01
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-arm64-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
  - name: genny_scale_InsertRemove
  - name: update_read_commands
  - name: insert_read_commands
  - name: misc_read_commands
  - name: singleThreaded_read_commands
  - name: wildcard-index-write_read_commands
  - name: pipeline-updates
  - name: wildcard-index-write_read_commands
  - name: pipeline-updates

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-mongo-perf-standalone-all-feature-flags.arm.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory (all feature flags) ARM AWS 2023-11
  modules: *perf_modules
  cron: "0 0 * * 0,2,3,4,5"  # Run it every day except Saturday and Monday.
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone-all-feature-flags.2023-02
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined.2023-01
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-arm64-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  # Same as standalone tasks, but with tasks required all feature flags added
  tasks: &mirobenchmarks-all-feature-flags-tasks
    - name: big_collection
    - name: genny_scale_InsertRemove
    - name: genny_execution_UserAcquisition
    - name: aggregation_read_commands
    - name: aggregation_read_commands_large_dataset
    - name: agg-query-comparison_read_commands
      cron: "0 0 * * 0,2,3,4,5" # *linux-microbenchmarks-standalone-arm contains high-value cron for this task. resetting correct cron
    - name: query_read_commands
    - name: query_read_commands_large_dataset
    - name: views-aggregation
    - name: views-query
    - name: where_read_commands
    - name: update_read_commands
    - name: insert_read_commands
    - name: wildcard-index-read_read_commands
    - name: wildcard-index-write_read_commands
    - name: geo_read_commands
    - name: misc_read_commands
    - name: misc_custom_filter_default_read_commands
    - name: misc_custom_filter_slow_or_sample_read_commands
    - name: misc_custom_filter_complex_read_commands
    - name: misc_custom_filter_whole_doc_read_commands
    - name: misc_slowms_everything_read_commands
    - name: singleThreaded_read_commands
    - name: pipeline-updates
    - name: javascript
    - name: compound_wildcard_index_write_commands
    - name: compound_wildcard_index_read_commands
    - name: tie-breaking-heuristics

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-mongo-perf-standalone-classic-query-engine.arm.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory (Classic Query Engine) ARM AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone-classic-query-engine.2023-02
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined.2023-01
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-arm64-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
    - name: big_collection
    - name: genny_scale_InsertRemove
    - name: genny_execution_UserAcquisition
    - name: aggregation_read_commands
    - name: aggregation_read_commands_large_dataset
    - name: agg-query-comparison_read_commands
      cron: *cron_query_perf_schedule # *linux-microbenchmarks-standalone-arm contains high-value cron for this task. resetting to correct cron
    - name: query_read_commands
    - name: query_read_commands_large_dataset
    - name: views-aggregation
    - name: views-query
    - name: where_read_commands
    - name: update_read_commands
    - name: insert_read_commands
    - name: wildcard-index-read_read_commands
    - name: wildcard-index-write_read_commands
    - name: geo_read_commands
    - name: misc_read_commands
    - name: misc_custom_filter_default_read_commands
    - name: misc_custom_filter_slow_or_sample_read_commands
    - name: misc_custom_filter_complex_read_commands
    - name: misc_custom_filter_whole_doc_read_commands
    - name: misc_slowms_everything_read_commands
    - name: singleThreaded_read_commands
    - name: pipeline-updates
    - name: javascript
    - name: compound_wildcard_index_write_commands
    - name: compound_wildcard_index_read_commands
    - name: tie-breaking-heuristics
  # yaml does not nicely merge arrays, so DO NOT ADD INDIVIDUAL TASKS HERE.
  # Add tasks to the anchor that this variant references
  # If diverging from that list, add the entire list of desired tasks here

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-mongo-perf-standalone-sbe.arm.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory (SBE) ARM AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone-sbe.2023-02
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined.2023-01
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-arm64-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
    - name: big_collection
    - name: genny_scale_InsertRemove
    - name: genny_execution_UserAcquisition
    - name: aggregation_read_commands
    - name: aggregation_read_commands_large_dataset
    - name: agg-query-comparison_read_commands
      cron: *cron_query_perf_schedule # *linux-microbenchmarks-standalone-arm contains high-value cron for this task. resetting to correct cron
    - name: query_read_commands
    - name: query_read_commands_large_dataset
    - name: views-aggregation
    - name: views-query
    - name: where_read_commands
    - name: update_read_commands
    - name: insert_read_commands
    - name: wildcard-index-read_read_commands
    - name: wildcard-index-write_read_commands
    - name: geo_read_commands
    - name: misc_read_commands
    - name: misc_custom_filter_default_read_commands
    - name: misc_custom_filter_slow_or_sample_read_commands
    - name: misc_custom_filter_complex_read_commands
    - name: misc_custom_filter_whole_doc_read_commands
    - name: misc_slowms_everything_read_commands
    - name: singleThreaded_read_commands
    - name: pipeline-updates
    - name: javascript
    - name: compound_wildcard_index_write_commands
    - name: compound_wildcard_index_read_commands
    - name: tie-breaking-heuristics
  # yaml does not nicely merge arrays, so DO NOT ADD INDIVIDUAL TASKS HERE.
  # Add tasks to the anchor that this variant references
  # If diverging from that list, add the entire list of desired tasks here

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-mongo-perf-standalone-sampling-bonsai.arm.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory (Bonsai with Sampling CE) ARM AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone-sampling-bonsai.2023-02
      # Try to use the Bonsai optimizer with sampling CE mode, or fall back to the classic planner.
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined.2023-01
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-arm64-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks: &mongo-perf-bonsai-tasks
    - name: agg-query-comparison_read_commands
    - name: aggregation_read_commands
    - name: big_collection
    - name: query_read_commands
    - name: query_read_commands_large_dataset

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-mongo-perf-standalone-heuristic-bonsai.arm.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory (Bonsai with Heuristic CE) ARM AWS 2023-11
  cron: "0 0 * * 0"  # Run it only on Sunday.
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone-heuristic-bonsai.2023-02
      # Try to use the Bonsai optimizer with heuristic CE mode, or fall back to the classic planner.
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined.2023-01
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-arm64-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks: *mongo-perf-bonsai-tasks

- <<: *linux-mongo-perf-repl-arm
  name: perf-mongo-perf-repl-all-feature-flags.arm.aws.2023-01
  display_name: PERF Mongo-Perf 1-Node ReplSet inMemory (all feature flags) ARM AWS 2023-11
  cron: "0 0 * * 0,2,3,4,5"  # Run it every day except Saturday and Monday.
  expansions:
    <<: *repl-arm-expansions
    mongodb_setup: mongo-perf-replica-all-feature-flags.2023-02
  # yaml does not nicely merge arrays, so DO NOT ADD INDIVIDUAL TASKS HERE.
  # Add tasks to the anchor that this variant references
  # If diverging from that list, add the entire list of desired tasks here

- &linux-mongo-perf-repl-intel
  <<: *amazon2_x86_compile_variant_dependency
  name: perf-mongo-perf-repl.intel.aws.2023-11
  display_name: PERF Mongo-Perf 1-Node ReplSet inMemory Intel AWS 2023-11
  cron: "0 0 * * 0,2,3,4,5"  # Run it every day except Saturday and Monday.
  modules: *perf_modules
  expansions: &repl-intel-expansions
    <<: *repl-arm-expansions
    infrastructure_provisioning: workload_client_mongod_combined_intel.2023-11
    compile_variant: amazon2-x86-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
  - name: genny_scale_InsertRemove
  - name: update_read_commands
  - name: insert_read_commands
  - name: misc_read_commands
  - name: singleThreaded_read_commands
  - name: wildcard-index-write_read_commands
  - name: pipeline-updates

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-mongo-perf-standalone-all-feature-flags.intel.aws.2023-01
  display_name: PERF Mongo-Perf Standalone inMemory (all feature flags) Intel AWS 2023-11
  cron: "0 0 * * 0,2,3,4,5"  # Run it every day except Saturday and Monday.
  modules: *perf_modules
  expansions: &standalone-intel-expansions # Update mongodb_setup to mongo-perf-standalone.2023-02 when reusing this anchor
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone-all-feature-flags.2023-02
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined_intel.2023-11
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-x86-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks: *mirobenchmarks-all-feature-flags-tasks
  # yaml does not nicely merge arrays, so DO NOT ADD INDIVIDUAL TASKS HERE.
  # Add tasks to the anchor that this variant references
  # If diverging from that list, add the entire list of desired tasks here

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-mongo-perf-standalone-classic-query-engine.intel.aws.2023-01
  display_name: PERF Mongo-Perf Standalone inMemory (Classic Query Engine) Intel AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    <<: *standalone-intel-expansions
    mongodb_setup: mongo-perf-standalone-classic-query-engine.2023-02
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
    - name: big_collection
    - name: genny_scale_InsertRemove
    - name: genny_execution_UserAcquisition
    - name: aggregation_read_commands
    - name: aggregation_read_commands_large_dataset
    - name: agg-query-comparison_read_commands
      cron: *cron_query_perf_schedule # *linux-microbenchmarks-standalone-arm contains high-value cron for this task. Resetting to correct cron
    - name: query_read_commands
    - name: query_read_commands_large_dataset
    - name: views-aggregation
    - name: views-query
    - name: where_read_commands
    - name: update_read_commands
    - name: insert_read_commands
    - name: wildcard-index-read_read_commands
    - name: wildcard-index-write_read_commands
    - name: geo_read_commands
    - name: misc_read_commands
    - name: misc_custom_filter_default_read_commands
    - name: misc_custom_filter_slow_or_sample_read_commands
    - name: misc_custom_filter_complex_read_commands
    - name: misc_custom_filter_whole_doc_read_commands
    - name: misc_slowms_everything_read_commands
    - name: singleThreaded_read_commands
    - name: pipeline-updates
    - name: javascript
    - name: compound_wildcard_index_write_commands
    - name: compound_wildcard_index_read_commands
    - name: tie-breaking-heuristics
  # yaml does not nicely merge arrays, so DO NOT ADD INDIVIDUAL TASKS HERE.
  # Add tasks to the anchor that this variant references
  # If diverging from that list, add the entire list of desired tasks here

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-mongo-perf-standalone-sbe.intel.aws.2023-01
  display_name: PERF Mongo-Perf Standalone inMemory (SBE) Intel AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    <<: *standalone-intel-expansions
    mongodb_setup: mongo-perf-standalone-sbe.2023-02
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
    - name: big_collection
    - name: genny_scale_InsertRemove
    - name: genny_execution_UserAcquisition
    - name: aggregation_read_commands
    - name: aggregation_read_commands_large_dataset
    - name: agg-query-comparison_read_commands
      cron: *cron_query_perf_schedule # *linux-microbenchmarks-standalone-arm contains high-value cron for this task. Resetting to correct cron
    - name: query_read_commands
    - name: query_read_commands_large_dataset
    - name: views-aggregation
    - name: views-query
    - name: where_read_commands
    - name: update_read_commands
    - name: insert_read_commands
    - name: wildcard-index-read_read_commands
    - name: wildcard-index-write_read_commands
    - name: geo_read_commands
    - name: misc_read_commands
    - name: misc_custom_filter_default_read_commands
    - name: misc_custom_filter_slow_or_sample_read_commands
    - name: misc_custom_filter_complex_read_commands
    - name: misc_custom_filter_whole_doc_read_commands
    - name: misc_slowms_everything_read_commands
    - name: singleThreaded_read_commands
    - name: pipeline-updates
    - name: javascript
    - name: compound_wildcard_index_write_commands
    - name: compound_wildcard_index_read_commands
    - name: tie-breaking-heuristics
  # yaml does not nicely merge arrays, so DO NOT ADD INDIVIDUAL TASKS HERE.
  # Add tasks to the anchor that this variant references
  # If diverging from that list, add the entire list of desired tasks here

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-mongo-perf-standalone-sampling-bonsai.intel.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory (Bonsai with Sampling CE) Intel AWS 2023-11
  cron: *cron_query_perf_schedule
  expansions:
    <<: *standalone-intel-expansions
    mongodb_setup: mongo-perf-standalone-sampling-bonsai.2023-02
    # Try to use the Bonsai optimizer with sampling CE mode, or fall back to the classic planner.
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks: *mongo-perf-bonsai-tasks

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-mongo-perf-standalone-heuristic-bonsai.intel.aws.2023-01
  display_name: PERF Mongo-Perf Standalone inMemory (Bonsai with Heuristic CE) Intel AWS 2023-11
  cron: *cron_query_perf_schedule
  modules: *perf_modules
  expansions:
    <<: *standalone-intel-expansions
    mongodb_setup: mongo-perf-standalone-heuristic-bonsai.2023-02
    # Try to use the Bonsai optimizer with heuristic CE mode, or fall back to the classic planner.
  run_on:
    - "rhel70-perf-microbenchmarks"
  tasks: *mongo-perf-bonsai-tasks

- <<: *linux-mongo-perf-repl-intel
  name: perf-mongo-perf-repl-all-feature-flags.intel.aws.2023-01
  display_name: PERF Mongo-Perf 1-Node ReplSet inMemory (all feature flags) Intel AWS 2023-11
  cron: "0 0 * * 0,2,3,4,5"  # Run it every day except Saturday and Monday.
  expansions:
    <<: *repl-intel-expansions
    mongodb_setup: mongo-perf-replica-all-feature-flags.2023-02
  # yaml does not nicely merge arrays, so DO NOT ADD INDIVIDUAL TASKS HERE.
  # Add tasks to the anchor that this variant references
  # If diverging from that list, add the entire list of desired tasks here

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-longRunning.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet Long-Running ARM AWS 2023-11
  cron: "0 0 * * 6"  # 00:00 on every Saturday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: M60-like-single-large-volume.2023-02
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks:
    - name: tsbs_query_high_cardinality
    - name: tsbs_query_medium_cardinality

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-all-feature-flags-longRunning.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet (all feature flags) Long-Running ARM AWS 2023-11
  cron: "0 0 * * 6"  # 00:00 on every Saturday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: single-replica-all-feature-flags
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: M60-like-single-large-volume.2023-02
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks:
    - name: tsbs_query_high_cardinality
    - name: tsbs_query_medium_cardinality

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-arm-3-shard-resharding.arm.aws.2023-11
  display_name: PERF 3-Shard Resharding ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: resharding-3shard.2023-08
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: resharding-3shard.2023-08
    workload_setup: 2022-11
    snapshotId: snap-04f729f7224909902 # FCV 8.0
    platform: linux
    authentication: disabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    project_dir: *perf_project_dir
  run_on:
    - "rhel70-perf-shard"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: genny_resharding_withIndexes

# Uncomment this to run resharding snapshot FCV updates automatically.
# This is only intended to be run in patch builds.
# - <<: *amazon_linux2_arm64_compile_variant_dependency
#   name: resharding-3shard-snapshot-update
#   display_name: Resharding 3-Shard Snapshot Update
#   cron: "0 0 * * 4"  # 00:00 on Thursday
#   modules: *perf_modules
#   expansions:
#     mongodb_setup_release: 2022-11
#     mongodb_setup: resharding-3shard-snapshot-update.2023-10
#     infrastructure_provisioning_release: 2022-11
#     infrastructure_provisioning: resharding-3shard-snapshot-update.2023-10
#     # Update this to latest snapshot after each LTS release.
#     snapshotId: snap-0e7434150d05e0e47 # FCV 7.3
#     platform: linux
#     authentication: disabled
#     storageEngine: wiredTiger
#     project_dir: *perf_project_dir
#     compile_variant: amazon2-arm64-compile
#   run_on:
#     - "rhel70-perf-shard"
#   tasks:
#     - *schedule_patch_auto_tasks_task
#     - *schedule_variant_auto_tasks_task
#     - name: resharding-3shard-snapshot-update

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-query-settings.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QuerySettings) ARM AWS 2023-11
  cron: *linux-3-node-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-query-settings
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - name: schedule_variant_auto_tasks
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: tpcc_majority
    - name: linkbench2
    - name: mixed_workloads_genny_rate_limited_high_value
    - name: majority_reads10_k_threads_high_value
    - name: bestbuy_agg
    - name: large_indexed_ins_high_value
    - name: expressive_queries_high_value
    - name: time_series_sort_high_value
    - name: tsbs_query
    - name: array_traversal_high_value
    - name: filter_with_complex_logical_expression_high_value
    - name: tsbs_query

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-shard-query-settings.arm.aws.2023-11
  display_name: PERF 3-Shard Cluster (QuerySettings) ARM AWS 2023-11
  cron: *linux-3-shard-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-query-settings
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard"
  tasks:
    - *schedule_patch_auto_tasks_task
    - name: schedule_variant_auto_tasks
    - name: ycsb.2023-09
    - name: tpcc_majority
    - name: mixed_workloads_genny_rate_limited_high_value
    - name: bestbuy_agg
    - name: large_indexed_ins_high_value
    - name: expressive_queries_high_value
    - name: time_series_sort_high_value
    - name: tsbs_query
    - name: array_traversal_high_value
    - name: filter_with_complex_logical_expression_high_value
    - name: tsbs_query
    - name: mongos_workloads

- &3node-query-stats-rate-limit
  <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-limited-1-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 1) ARM AWS 2023-11
  cron: *high-value-workload-cron
  modules: *perf_modules
  expansions: &3node-query-stats-rate-limit-expansions
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-query-stats-rate-limit
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    config_params_json: '{"v": 0, "internalQueryStatsRateLimit": 1}'
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - name: schedule_variant_auto_tasks
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: tpcc_majority
    - name: linkbench2
    - name: mixed_workloads_genny_rate_limited_high_value
    - name: majority_reads10_k_threads_high_value
    - name: bestbuy_agg
    - name: large_indexed_ins_high_value
    - name: expressive_queries_high_value
    - name: time_series_sort_high_value
    - name: tsbs_query

- <<: *3node-query-stats-rate-limit
  name: perf-3-node-replSet-limited-10-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 10) ARM AWS 2023-11
  expansions:
    <<: *3node-query-stats-rate-limit-expansions
    config_params_json: '{"v": 0, "internalQueryStatsRateLimit": 10}'

- <<: *3node-query-stats-rate-limit
  name: perf-3-node-replSet-limited-1000-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 1000) ARM AWS 2023-11
  expansions:
    <<: *3node-query-stats-rate-limit-expansions
    config_params_json: '{"v": 0, "internalQueryStatsRateLimit": 1000}'

- <<: *3node-query-stats-rate-limit
  name: perf-3-node-replSet-limited-10000-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 10000) ARM AWS 2023-11
  expansions:
    <<: *3node-query-stats-rate-limit-expansions
    config_params_json: '{"v": 0, "internalQueryStatsRateLimit": 10000}'


# Variant which runs a single shard cluster with a config
# shard and mongos process processes co-located on the
# same machine as the mongod.
# This variant is a performance comparison point between
# a traditional single node replica set as defined in the
# 'Linux 1-Node ReplSet 2022-11' variant and fully embedded
# single shard clusters.
- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-1-node-replSet-default-sharding.arm.aws.2023-11
  display_name: PERF 1-Node ReplSet Default Sharding ARM AWS 2023-11
  cron: *linux-1-node-repl-cron
  modules: *perf_modules
  expansions:
    <<: *linux_arm64_generic_expansions
    idle_timeout_factor: 1.5
    exec_timeout_factor: 1.5
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-one-node-default-sharding
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - rhel70-small
  # Not using 1nodetasks because some need to be temporarily disabled.
  # TODO SERVER-87402: Use 1nodetasks once all tasks can work on this variant.
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_single_thread
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    # - name: crud_workloads_majority
    # - name: misc_workloads
    # - name: map_reduce_workloads
    - name: smoke_test
    - name: canaries_only
    - name: non_sharded_workloads
    # - name: bestbuy_agg
    # - name: bestbuy_agg_merge_different_db
    # - name: bestbuy_agg_merge_same_db
    # - name: bestbuy_agg_merge_wordcount
    # - name: bestbuy_query
    # - name: change_streams_latency
    # - name: change_streams_listen_throughput
    # - name: snapshot_reads
    - name: linkbench
    - name: linkbench2
    # - name: tsbs_load
    # - name: tsbs_query
    # - name: tsbs_query_finance
    # - name: tsbs_query_manual_bucketing
    # - name: tsbs_query_fixed_bucketing
    # - name: tsbs-query-genny
    # - name: tsbs-query-optimizations
    # - name: tpcc
    # - name: tpcc_majority
    # - name: tpch_1_normalized
    # - name: tpch_1_denormalized
    # - name: tpch_10_normalized
    # - name: tpch_10_denormalized
    # - name: genny_execution_ValidationFull

# Variant which runs a single shard cluster with a config
# shard and mongos processes processes co-located on the
# same machine as the mongods.
# This variant is a performance comparison point between
# a traditional replica set as defined in the
# 'Linux 3-Node ReplSet 2022-11' variant and fully embedded
# single shard clusters.
- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-default-sharding.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet Default Sharding ARM AWS 2023-11
  cron: *linux-3-node-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-default-sharding
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
      cron: *high-value-workload-cron
    - name: ycsb_single_thread
    - name: ycsb_w1.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb.load
    - name: ycsb_60GB.long.2023-09
      cron: *high-value-workload-cron
    - name: ycsb_secondary_reads.2023-09
    # TODO SERVER-87402: Enable these tasks.
    # - name: crud_workloads_majority
    # - name: crud_workloads_w1
    # - name: misc_workloads
    # - name: map_reduce_workloads
    - name: smoke_test
    - name: secondary_performance # Uses a special 2 node mongodb setup
    - name: non_sharded_workloads
    # TODO SERVER-87402: Enable these tasks.
    # - name: bestbuy_agg
      # cron: *high-value-workload-cron
    # - name: bestbuy_agg_merge_different_db
    # - name: bestbuy_agg_merge_same_db
    # - name: bestbuy_agg_merge_wordcount
    # - name: bestbuy_query
    # - name: change_streams_preimage_throughput
    # - name: change_streams_latency
    # - name: change_streams_preimage_latency
    # - name: change_streams_listen_throughput
    # - name: snapshot_reads
    # - name: secondary_reads
    # - name: tpcc
    # - name: tpcc_majority
      # cron: *high-value-workload-cron
    # - name: tpch_1_normalized
    # - name: tpch_1_denormalized
    # TODO: Enable in SERVER-66572.
    # - name: tpch_10_normalized
    # - name: tpch_10_denormalized
    - name: linkbench
    - name: linkbench2
      cron: *high-value-workload-cron
    # TODO SERVER-87402: Enable these tasks.
    # - name: tsbs_load
      # cron: *high-value-workload-cron
    # - name: tsbs_query
      # cron: *high-value-workload-cron
    # - name: tsbs_query_finance
    # - name: tsbs_query_manual_bucketing
    # - name: tsbs_query_fixed_bucketing
    # - name: tsbs-query-genny
    # - name: tsbs-query-optimizations
    # - name: tsbs-expression-query
    # - name: big_update_10k
    # - name: mixed_workloads_genny_rate_limited_high_value
      # cron: *high-value-workload-cron
    # - name: load_test_high_value
      # cron: *high-value-workload-cron
    # - name: majority_reads10_k_threads_high_value
      # cron: *high-value-workload-cron
    # - name: large_indexed_ins_high_value
      # cron: *high-value-workload-cron
    # - name: expressive_queries_high_value
      # cron: *high-value-workload-cron
    # - name: time_series_sort_high_value
      # cron: *high-value-workload-cron
    # - name: array_traversal_high_value
    # - name: filter_with_complex_logical_expression_high_value
    # - name: mongos_workloads
