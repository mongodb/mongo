load("//bazel/resmoke:resmoke.bzl", "resmoke_suite_test")

resmoke_suite_test(
    name = "core",
    srcs = [
        "//jstests/core/administrative/fsync:fsync.js",
        "//jstests/core/catalog/collstats:collStats_numericOnly.js",
        "//jstests/core/catalog/collstats:views_coll_stats.js",
        "//jstests/core/diagnostics/datasize:datasize2.js",
        "//jstests/core/diagnostics/datasize:datasize_validation.js",
        "//jstests/core/replicate_record_ids:allow_capped.js",
        "//jstests/core/replicate_record_ids:collmod_removes_replicate_record_ids.js",
        "//jstests/core/replicate_record_ids:replicate_record_ids_collection_creation.js",
    ],
    config = "//buildscripts/resmokeconfig:suites/core.yml",
    data = ["//buildscripts/resmokeconfig:common_jstest_data"],
    resmoke_args = ["--runAllFeatureFlagTests"],
    tags = [
        "ci-development-critical-single-variant",
        "server-storage-engine-integration",
    ],
    deps = [
        "//src/mongo/db:mongod",
        "//src/mongo/shell:mongo",
    ],
)

resmoke_suite_test(
    name = "no_passthrough",
    srcs = [
        "//jstests/noPassthrough/compression:compression_options.js",
        "//jstests/noPassthrough/compression:exhaust_compression.js",
        "//jstests/noPassthrough/killOp:datasize_killOp.js",
        "//jstests/noPassthrough/killOp:killOp_against_journal_flusher_thread.js",
        "//jstests/noPassthrough/killOp:killOp_against_user_write_waiting_on_journal_flusher_thread.js",
        "//jstests/noPassthrough/lock_file:lock_file.js",
        "//jstests/noPassthrough/lock_file:lock_file_fail_to_open.js",
        "//jstests/noPassthrough/recordid:prepare_recordid_initialization.js",
        "//jstests/noPassthrough/shutdown:shutdown_while_fsync_locked.js",
        "//jstests/noPassthrough/shutdown:shutdown_with_fsync.js",
        "//jstests/noPassthrough/txns_cache_errors:temporarily_unavailable_error.js",
        "//jstests/noPassthrough/txns_cache_errors:transaction_aborted_under_cache_pressure.js",
        "//jstests/noPassthrough/txns_retryable_writes_sessions:skip_write_conflict_retries_failpoint.js",
        "//jstests/noPassthrough/wt_integration:block_compressor_options.js",
        "//jstests/noPassthrough/wt_integration:configure_with_type_lsm.js",
        "//jstests/noPassthrough/wt_integration:devnull.js",
        "//jstests/noPassthrough/wt_integration:inmem_config_str.js",
        "//jstests/noPassthrough/wt_integration:inmem_full.js",
        "//jstests/noPassthrough/wt_integration:server_status_history_storage_stats.js",
        "//jstests/noPassthrough/wt_integration:wt_change_log_compressor.js",
        "//jstests/noPassthrough/wt_integration:wt_delayed_secondary_read_concern_majority.js",
        "//jstests/noPassthrough/wt_integration:wt_index_option_defaults.js",
        "//jstests/noPassthrough/wt_integration:wt_malformed_creation_string.js",
        "//jstests/noPassthrough/wt_integration:wt_operation_stats.js",
        "//jstests/noPassthrough/wt_integration:wt_skip_prepare_conflicts_retries_failpoint.js",
    ],
    config = "//buildscripts/resmokeconfig:suites/no_passthrough.yml",
    data = [
        "//buildscripts/resmokeconfig:common_jstest_data",
        "//jstests/core/txns/libs:prepare_helpers.js",
    ],
    resmoke_args = ["--runAllFeatureFlagTests"],
    shard_count = 4,
    tags = [
        "ci-development-critical-single-variant",
        "server-storage-engine-integration",
    ],
    deps = [
        "//src/mongo/db:mongod",
        "//src/mongo/shell:mongo",
    ],
)

resmoke_suite_test(
    name = "no_passthrough_with_mongod",
    srcs = [
        "//jstests/noPassthrough/compression:compression_options.js",
        "//jstests/noPassthrough/compression:exhaust_compression.js",
        "//jstests/noPassthrough/killOp:datasize_killOp.js",
        "//jstests/noPassthrough/killOp:killOp_against_journal_flusher_thread.js",
        "//jstests/noPassthrough/killOp:killOp_against_user_write_waiting_on_journal_flusher_thread.js",
        "//jstests/noPassthrough/lock_file:lock_file.js",
        "//jstests/noPassthrough/lock_file:lock_file_fail_to_open.js",
        "//jstests/noPassthrough/recordid:prepare_recordid_initialization.js",
        "//jstests/noPassthrough/shutdown:shutdown_while_fsync_locked.js",
        "//jstests/noPassthrough/shutdown:shutdown_with_fsync.js",
        "//jstests/noPassthrough/txns_cache_errors:temporarily_unavailable_error.js",
        "//jstests/noPassthrough/txns_cache_errors:transaction_aborted_under_cache_pressure.js",
        "//jstests/noPassthrough/txns_retryable_writes_sessions:skip_write_conflict_retries_failpoint.js",
        "//jstests/noPassthrough/wt_integration:block_compressor_options.js",
        "//jstests/noPassthrough/wt_integration:configure_with_type_lsm.js",
        "//jstests/noPassthrough/wt_integration:devnull.js",
        "//jstests/noPassthrough/wt_integration:inmem_config_str.js",
        "//jstests/noPassthrough/wt_integration:inmem_full.js",
        "//jstests/noPassthrough/wt_integration:server_status_history_storage_stats.js",
        "//jstests/noPassthrough/wt_integration:wt_change_log_compressor.js",
        "//jstests/noPassthrough/wt_integration:wt_delayed_secondary_read_concern_majority.js",
        "//jstests/noPassthrough/wt_integration:wt_index_option_defaults.js",
        "//jstests/noPassthrough/wt_integration:wt_malformed_creation_string.js",
        "//jstests/noPassthrough/wt_integration:wt_operation_stats.js",
        "//jstests/noPassthrough/wt_integration:wt_skip_prepare_conflicts_retries_failpoint.js",
    ],
    config = "//buildscripts/resmokeconfig:suites/no_passthrough_with_mongod.yml",
    data = [
        "//buildscripts/resmokeconfig:common_jstest_data",
        "//jstests/core/txns/libs:prepare_helpers.js",
    ],
    resmoke_args = ["--runAllFeatureFlagTests"],
    shard_count = 4,
    tags = [
        "ci-development-critical-single-variant",
        "server-storage-engine-integration",
    ],
    deps = [
        "//src/mongo/db:mongod",
        "//src/mongo/shell:mongo",
    ],
)
